# Лабораторная работа № 9 - Каталог Молочных продуктов

## Описание
Приложение для управления каталогом молочных продуктов с использованием технологии EDM (Entity Data Model).

## Структура базы данных

### Таблица Product (Товар)
- ProductId (int) - первичный ключ
- ProductName (nvarchar(100)) - название товара
- Price (decimal(10,2)) - цена
- Category (nvarchar(50)) - категория
- ExpiryDays (int) - срок годности в днях
- Description (nvarchar(255)) - описание

### Таблица Sale (Продажа)
- SaleId (int) - первичный ключ
- SaleDate (datetime) - дата продажи
- CustomerName (nvarchar(100)) - имя клиента
- TotalAmount (decimal(10,2)) - общая сумма

### Таблица SaleDetails (Детали продаж)
- SaleDetailId (int) - первичный ключ
- SaleId (int) - внешний ключ на Sale
- ProductId (int) - внешний ключ на Product
- Quantity (int) - количество
- UnitPrice (decimal(10,2)) - цена за единицу

## Функциональность

### Главная форма (Form1)
- Отображение каталога товаров
- Вычисление максимальной, минимальной и средней цены
- Сортировка по цене (по возрастанию и убыванию)
- Поиск по точному названию
- Поиск по первым символам названия

### Форма продаж (SaleForm)
- Отображение списка продаж
- Сортировка по дате и сумме
- Поиск по имени клиента
- Вычисление статистики по суммам

## Установка и запуск

### Предварительные требования
- .NET 8.0 SDK
- SQL Server (LocalDB, Express или полная версия)
- SQL Server Management Studio (SSMS)

### Настройка базы данных
1. Откройте SQL Server Management Studio
2. Подключитесь к вашему экземпляру SQL Server
3. Откройте файл `Database/CreateDatabase.sql`
4. Выполните скрипт (F5) для создания базы данных и тестовых данных

Подробные инструкции см. в файле `Database/SETUP_INSTRUCTIONS.md`

### Настройка строки подключения
Если необходимо, обновите строку подключения в файле `Models/SalesContext.cs`:
```csharp
"Server=.;Database=Familia22i1L9;Integrated Security=true;TrustServerCertificate=true;Encrypt=false;"
```

### Запуск приложения
```bash
cd MilkProductsCatalog
dotnet run
```

## Технологии
- .NET 8.0
- Windows Forms
- Entity Framework Core 8.0
- SQL Server

## Возможности приложения

### Главная форма (Каталог товаров)
- Просмотр всех молочных продуктов
- Вычисление максимальной, минимальной и средней цены
- Сортировка по цене (по возрастанию и убыванию)
- Поиск по точному названию товара
- Поиск по первым символам названия
- Навигация к формам "Продажи" и "Детали продаж"

### Форма продаж
- Просмотр всех продаж
- Сортировка по дате продажи
- Сортировка по сумме продажи
- Поиск по имени клиента
- Вычисление статистики по суммам (макс, мин, средняя)

### Форма деталей продаж
- Просмотр деталей всех продаж с информацией о товарах и клиентах
- Сортировка по количеству товара
- Поиск по названию товара
- Вычисление статистики по количеству (макс, мин, среднее)

## Устранение проблем

### Ошибка подключения к базе данных
1. Убедитесь, что SQL Server запущен
2. Проверьте строку подключения в `Models/SalesContext.cs`
3. Выполните скрипт `Database/TestConnection.sql` для проверки данных
4. Для SQL Server Express используйте: `Server=.\\SQLEXPRESS;...`

### Ошибка "EnableRetryOnFailure"
Эта ошибка уже исправлена в коде. Если она все еще возникает:
1. Убедитесь, что используется последняя версия кода
2. Пересоберите проект: `dotnet clean` и `dotnet build`

## Автор
Вариант 25 - Класс «Молочные продукты»