# ОТЧЕТ ЛР-11: Привязки данных Binding

## 1. ПРОСТАЯ ПРИВЯЗКА ДАННЫХ К TEXTBOX

### XAML код:
```xml
<!-- Простая привязка к Product -->
<StackPanel x:Name="stProduct" Orientation="Vertical">
    <TextBlock Text="Артикул" FontWeight="Bold"/>
    <TextBox Text="{Binding idProduct}" Margin="2"/>
    <TextBlock Text="Наименование" FontWeight="Bold"/>
    <TextBox Text="{Binding nameProduct, Mode=TwoWay}" Margin="2"/>
    <TextBlock Text="Цена" FontWeight="Bold"/>
    <TextBox Text="{Binding priceProduct, Mode=TwoWay}" Margin="2"/>
    <TextBlock Text="Категория" FontWeight="Bold"/>
    <TextBox Text="{Binding Category}" Margin="2"/>
</StackPanel>
```

### C# код:
```csharp
// Возьмем любую запись из главной таблицы, например первую
var recProduct = db.Product.First();
stProduct.DataContext = recProduct;
```

**Что демонстрирует:** Простая привязка полей одной таблицы к элементам управления через DataContext.

---

## 2. СЛОЖНАЯ ПРИВЯЗКА ДАННЫХ К TEXTBOX

### XAML код:
```xml
<!-- Сложная привязка через связанные таблицы -->
<StackPanel x:Name="stDetail" Orientation="Vertical">
    <TextBlock Text="ID Детали" Foreground="DarkBlue" FontWeight="Bold"/>
    <TextBox Text="{Binding IdDetailSale}" Margin="2"/>
    <TextBlock Text="Артикул" Foreground="DarkBlue" FontWeight="Bold"/>
    <TextBox Text="{Binding IdProductDetailSale}" Margin="2"/>
    <TextBlock Text="Наименование" Foreground="DarkBlue" FontWeight="Bold"/>
    <TextBox Text="{Binding Product.nameProduct}" Margin="2"/>
    <TextBlock Text="Цена" Foreground="DarkBlue" FontWeight="Bold"/>
    <TextBox Text="{Binding Product.priceProduct}" Margin="2"/>
    <TextBlock Text="Количество" Foreground="DarkBlue" FontWeight="Bold"/>
    <TextBox Text="{Binding QuantityProduct, Mode=TwoWay}" Margin="2"/>
</StackPanel>
```

### C# код:
```csharp
// Возьмем любую запись из таблицы подчиненной, например первую
var recDetailProduct = db.DetailSale.Include(d => d.Product).First();
stDetail.DataContext = recDetailProduct;
```

**Что демонстрирует:** Сложная привязка - доступ к полям главной таблицы через навигационные свойства подчиненной таблицы.

---

## 3. ПРОСТАЯ ПРИВЯЗКА COMBOBOX

### XAML код:
```xml
<ComboBox x:Name="cmbProduct" 
          DisplayMemberPath="nameProduct" 
          SelectedValuePath="idProduct"
          SelectionChanged="CmbProduct_SelectionChanged"/>
```

### C# код:
```csharp
// Источник данных для ComboBox
cmbProduct.ItemsSource = db.Product.ToList();

// Обработчик выбора
private void CmbProduct_SelectionChanged(object sender, SelectionChangedEventArgs e)
{
    if (cmbProduct.SelectedValue != null)
    {
        int articul = Convert.ToInt32(cmbProduct.SelectedValue);
        txtSelectedId.Text = articul.ToString();
    }
}
```

**Что демонстрирует:** Простая привязка списка к ComboBox с получением выбранного значения.

---

## 4. СЛОЖНАЯ ПРИВЯЗКА COMBOBOX

### XAML код:
```xml
<ComboBox x:Name="cmbProductDetail" 
          DisplayMemberPath="nameProduct" 
          SelectedValuePath="idProduct"
          SelectedValue="{Binding IdProductDetailSale, Mode=TwoWay}"/>
```

### C# код:
```csharp
// Источник данных
cmbProductDetail.ItemsSource = db.Product.ToList();

// Контекст данных устанавливается для всего StackPanel
stDetailCombo.DataContext = detailSaleRecord;
```

**Что демонстрирует:** Двусторонняя привязка ComboBox к FK полю с автоматической синхронизацией.

---

## 5. ДОСТУП К СВЯЗАННЫМ ПОЛЯМ

### C# код:
```csharp
var recProductPriceFirst = db.DetailSale.Include(d => d.Product).First();

// Выбираем наименование по связи
string nameFirst = recProductPriceFirst.Product.nameProduct;

// Выбираем цену по связи  
decimal priceFirst = recProductPriceFirst.Product.priceProduct;
```

**Что демонстрирует:** Программный доступ к связанным данным через навигационные свойства Entity Framework.

---

## 6. ИЗМЕНЕНИЕ ЗАПИСИ С MODE=TWOWAY

### XAML код:
```xml
<TextBox Text="{Binding nameProduct, Mode=TwoWay}"/>
```

### C# код:
```csharp
// Сохранение изменений
db.SaveChanges();
```

**Что демонстрирует:** Автоматическое отслеживание изменений и сохранение в БД.

---

## 7. ДОБАВЛЕНИЕ НОВОЙ ЗАПИСИ

### A) Добавление Product:

#### C# код:
```csharp
// Переменная для нового объекта (видна во всех методах)
Product productNew = new Product();

// На событие добавления новой записи
private void NewProduct_Click(object sender, RoutedEventArgs e)
{
    productNew = new Product
    {
        nameProduct = "",
        priceProduct = 0,
        Category = ""
    };
    
    stProduct.DataContext = productNew; // Устанавливаем источник – новую запись
}

// Сохранение в БД
private void AddProduct_Click(object sender, RoutedEventArgs e)
{
    db.Product.Add(productNew);
    db.SaveChanges();
}
```

### B) Добавление SaleDetails:

#### C# код:
```csharp
// Переменная для нового объекта
SaleDetails detailSaleNew = new SaleDetails();

// На событие добавления новой записи
private void NewSaleDetail_Click(object sender, RoutedEventArgs e)
{
    detailSaleNew = new SaleDetails
    {
        IdSale = 1,
        IdProductDetailSale = 0,
        QuantityProduct = 0
    };
    
    stDetailCombo.DataContext = detailSaleNew; // Устанавливаем источник – новую запись
}

// Сохранение в БД
private void AddSaleDetail_Click(object sender, RoutedEventArgs e)
{
    db.DetailSale.Add(detailSaleNew);
    db.SaveChanges();
}
```

**Что демонстрирует:** Создание новых записей через привязку данных с последующим сохранением в БД.

---

## СКРИНШОТЫ ДЛЯ ОТЧЕТА

1. **Главное окно приложения** - общий вид интерфейса
2. **Простая привязка** - заполненные поля Product
3. **Сложная привязка** - поля SaleDetails с данными из связанной таблицы Product
4. **ComboBox простой** - выпадающий список продуктов
5. **ComboBox сложный** - привязка к FK полю
6. **Окно детального отображения** - форматированный вывод данных
7. **База данных в SSMS** - таблицы с данными до и после изменений

---

## НА ЧТО ПРЕПОДАВАТЕЛЬ ОБРАЩАЕТ ВНИМАНИЕ

✅ **Правильность привязок:**
- Использование {Binding} синтаксиса
- Корректные имена полей
- Mode=TwoWay для редактируемых полей

✅ **Работа с DataContext:**
- Установка контекста для контейнеров
- Понимание области видимости привязок

✅ **Связанные данные:**
- Использование Include() для загрузки связанных данных
- Доступ через навигационные свойства (Product.nameProduct)

✅ **ComboBox привязки:**
- DisplayMemberPath и SelectedValuePath
- Двусторонняя привязка SelectedValue

✅ **Сохранение данных:**
- Корректное использование SaveChanges()
- Обработка ошибок

✅ **Код организация:**
- Переменные уровня класса для новых объектов
- Правильная последовательность операций