<Window x:Class="MilkProductsBinding.Lab13Window"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ЛР-13: Работа со свойствами класса" Height="700" Width="1200"
        WindowStartupLocation="CenterScreen">
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Заголовок -->
        <TextBlock Grid.Row="0" Text="ЛР-13: Работа со свойствами класса - Вычисляемые свойства" 
                   FontSize="16" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,15"/>
        
        <!-- DataGrid для Sale с вычисляемыми свойствами -->
        <GroupBox Grid.Row="1" Header="Таблица Sale - Продажи с вычисляемыми свойствами" Margin="0,0,0,10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <DataGrid x:Name="dgSale" Grid.Row="0" AutoGenerateColumns="False" 
                          CanUserAddRows="False" IsReadOnly="True" Margin="5">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding IdSale}" Width="50"/>
                        <DataGridTextColumn Header="Дата" Binding="{Binding SaleDate, StringFormat=dd.MM.yyyy}" Width="80"/>
                        <DataGridTextColumn Header="Покупатель" Binding="{Binding CustomerName}" Width="150"/>
                        <DataGridTextColumn Header="Кол-во позиций" Binding="{Binding ItemsCount}" Width="100"/>
                        <DataGridTextColumn Header="Сумма (вычисл.)" Binding="{Binding SummaSaleCalculated, StringFormat=F2}" Width="120"/>
                        <DataGridTextColumn Header="Скидка %" Binding="{Binding DiscountSale, StringFormat=F1}" Width="80"/>
                        <DataGridTextColumn Header="Скидка ₽" Binding="{Binding DiscountAmount, StringFormat=F2}" Width="100"/>
                        <DataGridTextColumn Header="Итого (вычисл.)" Binding="{Binding ResultatCalculated, StringFormat=F2}" Width="120"/>
                        <DataGridTextColumn Header="Сумма (БД)" Binding="{Binding SummaSale, StringFormat=F2}" Width="100"/>
                        <DataGridTextColumn Header="Итого (БД)" Binding="{Binding Resultat, StringFormat=F2}" Width="100"/>
                    </DataGrid.Columns>
                </DataGrid>
                
                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="5">
                    <Button x:Name="btnLoadSales" Content="Загрузить продажи" Click="btnLoadSales_Click" Margin="0,0,10,0"/>
                    <Button x:Name="btnRecalculateSales" Content="Пересчитать и сохранить" Click="btnRecalculateSales_Click" Margin="0,0,10,0"/>
                    <TextBlock x:Name="tbSaleInfo" VerticalAlignment="Center" Foreground="Blue"/>
                </StackPanel>
            </Grid>
        </GroupBox>
        
        <!-- DataGrid для SaleDetails с вычисляемыми свойствами -->
        <GroupBox Grid.Row="2" Header="Таблица SaleDetails - Детали продаж с вычисляемыми свойствами" Margin="0,0,0,10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <DataGrid x:Name="dgSaleDetails" Grid.Row="0" AutoGenerateColumns="False" 
                          CanUserAddRows="False" IsReadOnly="True" Margin="5">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding IdDetailSale}" Width="50"/>
                        <DataGridTextColumn Header="ID Продажи" Binding="{Binding IdSale}" Width="80"/>
                        <DataGridTextColumn Header="Товар" Binding="{Binding Product.nameProduct}" Width="150"/>
                        <DataGridTextColumn Header="Количество" Binding="{Binding QuantityProduct}" Width="80"/>
                        <DataGridTextColumn Header="Цена за ед." Binding="{Binding UnitPrice, StringFormat=F2}" Width="100"/>
                        <DataGridTextColumn Header="Стоимость (вычисл.)" Binding="{Binding SummaProductCalculated, StringFormat=F2}" Width="130"/>
                        <DataGridTextColumn Header="Стоимость (БД)" Binding="{Binding SummaProduct, StringFormat=F2}" Width="110"/>
                        <DataGridTextColumn Header="Цена в каталоге" Binding="{Binding Product.priceProduct, StringFormat=F2}" Width="120"/>
                        <DataGridTextColumn Header="Разница цен" Binding="{Binding PriceDifference, StringFormat=F2}" Width="100"/>
                    </DataGrid.Columns>
                </DataGrid>
                
                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="5">
                    <Button x:Name="btnLoadDetails" Content="Загрузить детали" Click="btnLoadDetails_Click" Margin="0,0,10,0"/>
                    <Button x:Name="btnRecalculateDetails" Content="Пересчитать и сохранить" Click="btnRecalculateDetails_Click" Margin="0,0,10,0"/>
                    <TextBlock x:Name="tbDetailInfo" VerticalAlignment="Center" Foreground="Blue"/>
                </StackPanel>
            </Grid>
        </GroupBox>
        
        <!-- Информационная панель -->
        <GroupBox Grid.Row="3" Header="Информация о вычисляемых свойствах">
            <TextBlock TextWrapping="Wrap" Margin="5">
                <Run Text="Демонстрация вычисляемых свойств:" FontWeight="Bold"/>
                <LineBreak/>
                <Run Text="• SummaSaleCalculated = SUM(Quantity * UnitPrice) для всех позиций продажи"/>
                <LineBreak/>
                <Run Text="• ResultatCalculated = SummaSale - (SummaSale * DiscountSale / 100)"/>
                <LineBreak/>
                <Run Text="• SummaProductCalculated = Quantity * UnitPrice"/>
                <LineBreak/>
                <Run Text="• PriceDifference = (Product.priceProduct - UnitPrice) * Quantity"/>
                <LineBreak/>
                <Run Text="Вычисляемые свойства обновляются автоматически при изменении данных!" FontWeight="Bold" Foreground="Red"/>
            </TextBlock>
        </GroupBox>
    </Grid>
</Window>